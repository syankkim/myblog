---
title: 🗄 파일 시스템
tags: ['file_system','inode']
categories: [☁️ OS]
thumbnail: ''
permalink: ''
status: ''
date: 2021-05-15 20:44:27
---

inode 와 가상 파일 시스템
`#inode` `#file_system`
<!-- excerpt -->
<!-- toc -->

---

*💬 해당 강의는 fastcampus 에서 '컴공 전공자 따라잡기 온라인 완주반' 강의를 들으며 스스로의 학습을 위해 작성한 포스팅입니다. 문제가 된다면 연락 부탁드립니다.*

<br>

# 파일 시스템이란 ?
> 운영체제가 저장매체에 파일을 쓰기 위한 자료구조 또는 알고리즘을 의미한다.

## 파일 시스템이 만들어진 이유?
- 블록: `블록` 단위로(보통 4KB), 블록마다 고유 번호를 부여해서 관리한다.
 - 0과 1의 데이터를 비트로 저장하기에는 오버헤드 발생하기 때문.
- 파일: 사용자는 `파일` 단위로 관리하며, 각 파일에는 블록 단위로 관리된다.
 - 사용자가 블록 단위로 고유번호를 관리하기 어렵기 때문.

## 파일 시스템 저장 방법
- 가능한 연속적 공간에 파일을 저장하는것이 좋으나, 파일 사이즈가 가변적이라면 외부 단편화가 일어날 수 있다.
- 따라서,  불연속 공간에 파일을 저장하는 기능이 필요하다.
 - `블록체인`: 각 블록을 링크드 리스트로 연결한다. 어떤 주소를 찾으려면 처음부터 주소를 따라가야 하는 단점이 있다.
 - `인덱스 블록`: 각 블록에 대한 위치정보를 기억해서, 한번에 그 블록을 찾을 수 있다.

## 파일시스템과 시스템콜
- 동일한 시스템콜을 사용해서 다양한 파일 시스템 지원 가능하도록 구현되어 있다.
- 파일을 실제로 어떻게 저장하는지는 다를 수 있다.
 - 리눅스의 경우 ext4, NTFS, FAT32 파일시스템을 지원한다.

# inode 방식 파일 시스템
- 파일시스템의 기본 구조
 - 수퍼블록: 파일시스템 정보
 - 아이노드 블록: 파일 상세정보 (PCB)
 - 데이터 블록: 실제 데이터 (1KB~4KB)

<br>
<img width="316" alt="파일시스템구조" src="https://user-images.githubusercontent.com/28856435/118361659-6b678d80-b5c7-11eb-87d4-839182efbba0.PNG">

<br>

## 수퍼블록
- 파일시스템 정보 및 파티션 정보를 포함한다.
- 리눅스 명령어 `df` 를 했을 때 출력되는 정보들.

## inode와 파일
- 파일 `inode 고유값`과 `자료구조`에 의해 주요 정보를 관리한다.
- 파이이름 : inode => 파일이름은 inode 와 매칭된다.
- 파일 시스템에서는 inode 기반으로 파일에 엑세스 한다.
 - `inode 기반의 메타 데이터` : 파일권한, 소유자 정보, 파일 사이즈, 생성시간 등
- 각 `디렉토리 엔트리`(dentry)를 탐색
 - /home/ubuntu/link.txt : `/` 마다 `dentry` 를 가지고 있다.
- 파일생성 > inode 번호 > inode 블록 <- 파일 쿼리

- 아래 명령을 실행할 경우,
 - inode 번호 > inode 블록 접근 > 해당 데이터를 읽어옴.

```shell
> cat data.txt
```

    
<br>
<img width="773" alt="inode구조" src="https://user-images.githubusercontent.com/28856435/118361800-e92b9900-b5c7-11eb-8da3-0791cdf1dfc7.PNG">
<br>

# 디렉토리 엔트리
- 디렉토리를 표현하는 데 쓰이는 자료구조이다.
- 일반적으로 파일이름, 파일 속성 등 여러가지 정보가 저장되는데, 유닉스 계열에서는 `파일이름`과 `inode번호`만 저장된다.
- 리눅스 파일탐색: /home/ubuntu/ink.txt
 - 각 디렉토리 엔트리를 탐색 : 각 엔트리는 해당 디렉토리 파일/디렉토리 정보를 가지고 있다.
- 즉 `/` - `home` - `ubuntu` - `link.txt` 순으로 파일을 찾아 해당 `inode` 를 얻는다. 


## 가상 파일 시스템
- Network 등 다양한 기기도 동일한 파일시스템 인터페이스를 통해 관리가능
 - eg. read/write 시스템콜 사용, 각 기기별 read_spec/write_spec 코드 구현 (운영체제 내부)
- 추상화 (abstraction)
 - 복잡한 기능/자료/데이터의 핵심적 개념과 기능을 간추려 내는것.
 - input/output 을 통해 모든 디바이스를 `파일 interface` 로 다룬다.

> 모든 것은 파일이라는 철학
> - 모든 인터렉션 파일을 읽고, 쓰는것처럼 이루어져 있다.
> - 마우스, 키보드와 같은 모든 디바이스 관련 기술 또한 파일과 같이 다루어짐.
> __즉, 모든 자원에 대한 추상화 인터페이스로 파일 인터페이스를 활용한다.__


## 특수파일 -디바이스
- 블록 디바이스(Block Device): HDD, CD/DVD 같이 블록 또는 섹터 단위 등 정해진 단위로 데이터를 전송한다. I/O 송수신 속도가 높다.
- 캐릭터 디바이스 (Character Device): 키보드, 마우스 등 byte 단위 데이터를 전송한다. I/O 송수신 속도가 낮다.


### 캐릭터 디바이스-tty
- 가상파일 시스템 인터페이스를 통해서, `가상 터미널환경(디바이스)`에 연결이 되어있다. 이 디바이스에 input 을 주는것은 `키보드`이다.
- 아래 예제를 보면, tty라는 파일을 출력하면, 키보드로 입력하는 것이 두 번 출력된다.
 - 키보드에 직접 입력하면 첫번째출력. `tty`-`cat`명령어를 통해 두번째 출력.
```shell
ubuntu@ip-172-31-42-223:/dev$ cat tty
hello
hello
i'm
i'm
suyeon
suyeon
```
즉, 터미널 조차도 가상시스템 인터페이스를 통해서 일종의 파일처럼 다뤄지고 있으며, 그 파일을 읽거나 쓰면 해당 디바이스를 다룰 수 있다.(운영체제와 통신할 수 있다.)

